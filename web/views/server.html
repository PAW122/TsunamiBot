<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base href="/">
    <style>
        body {
            margin: 0;
            font-family: 'Arial', sans-serif;
        }

        .top-bar {
            background-color: #7289DA;
            padding: 10px;
            text-align: right;
            position: fixed;
            width: 100%;
            top: 0;
            z-index: 1;
        }

        .top-bar a {
            color: white;
            text-decoration: none;
            margin-right: 15px;
        }

        .dashboard-container {
            display: flex;
            /* Zmiana na column */
            flex-direction: column;
            align-items: flex-start;
            margin-top: 20px;
            height: 95.9vh;
            background-color: #2C2F33;
            color: white;
            padding: 20px;
        }

        .avatar-server-container {
            display: flex;
            align-items: flex-start;
            margin-bottom: 20px; /* Dodane, aby zwiększyć odstęp między avatarem a kafelkami */
        }

        .avatar-container,
        .server-details {
            margin-right: 20px;
        }

        .avatar-container {
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        #avatar {
            border-radius: 50%;
            width: 60px;
            height: 60px;
            margin-bottom: 10px;
        }

        #name {
            font-size: 24px;
        }

        /* Style for server details */
        .server-details {
            color: white;
        }

        #server-avatar {
            border-radius: 50%;
            width: 60px;
            height: 60px;
            margin-bottom: 10px;
        }

        .kafelki {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-top: 20px;
        }

        .kafelek {
            flex: 1;
            max-width: 300px;
            padding: 20px;
            background-color: #7289DA;
            border-radius: 8px;
            color: white;
        }

        .toggle-container {
            display: flex;
            align-items: center;
        }

        .toggle-label {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
        }

        .toggle-input {
            opacity: 0;
            width: 0;
            height: 0;
        }

        .toggle-slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            border-radius: 34px;
            transition: .4s;
        }

        .toggle-slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            border-radius: 50%;
            transition: .4s;
        }

        input:checked + .toggle-slider {
            background-color: #2196F3;
        }

        input:checked + .toggle-slider:before {
            transform: translateX(26px);
        }
    </style>
</head>

<body>
    <div class="top-bar">
        <a href="https://discord.com/api/oauth2/authorize?client_id=928399458570502155&permissions=8&scope=bot+applications.commands"
            target="_blank">Invite</a>
        <a href="/" class="text-sm mt-5 logout-link">Logout</a>
    </div>

    <div class="dashboard-container">
        <div class="avatar-server-container">
            <div class="avatar-container">
                <img src='' id="avatar" class="rounded-full w-12 h-12" />
                <div id="name"></div>
            </div>

            <div class="server-details">
                <div id="server-avatar-container"></div>
                <div id="server-name"></div>
                <!-- Content will be added here dynamically -->
            </div>
        </div>

        <div class="kafelki">
            <div class="kafelek">
                <div>
                    <h3>Welcome Command</h3>
                    <!-- Pole do wyboru kanału -->
                    <label for="channelSelect">Select Channel:</label>
                    <select id="channelSelect">
                        <!-- Opcje kanałów zostaną dodane dynamicznie w kodzie JavaScript -->
                    </select>

                    <!-- Przycisk switch włączający i wyłączający komendę -->
                    <div class="toggle-container">
                        <label class="toggle-label" for="switchButton">
                            <input type="checkbox" id="switchButton" class="toggle-input" onclick="toggleWelcomeCommand()">
                            <div class="toggle-slider"></div>
                        </label>
                    </div>
                </div>
            </div>
            <!-- Kolejne kafelki mogą być dodane tutaj -->
        </div>
    </div>

    <script>
        window.onload = () => {
            const urlParams = new URLSearchParams(window.location.search);
            const accessToken = urlParams.get('access_token');
            const tokenType = urlParams.get('token_type');
            const serverId = urlParams.get('server_id');

            if (!accessToken || !tokenType || !serverId) {
                window.location.href('/');
                console.log("Błąd logowania");
            }

            // Fetch user information
            fetch('https://discord.com/api/users/@me', {
                headers: {
                    authorization: `${tokenType} ${accessToken}`,
                },
            })
                .then(result => result.json())
                .then(response => {
                    console.log(response);
                    const { username, discriminator, avatar, id } = response;
                    // Set the welcome username string
                    document.getElementById('name').innerText = ` ${username}#${discriminator}`;

                    // Set the avatar image by constructing a URL to access Discord's CDN
                    document.getElementById("avatar").src = `https://cdn.discordapp.com/avatars/${id}/${avatar}.jpg`;

                    // Fetch user's guilds (servers)
                    fetch('https://discord.com/api/users/@me/guilds', {
                        headers: {
                            authorization: `${tokenType} ${accessToken}`,
                        },
                    })
                        .then(guildsResult => guildsResult.json())
                        .then(guildsResponse => {
                            console.log(guildsResponse);

                            // Find the specific server in the user's guilds
                            const server = guildsResponse.find(guild => guild.id === serverId);

                            // req do wewnętrznego api po dane o serwerze (kanały txt)
                            // dla welcome messages
                            // można wywołać handler w main(bo tam ma dostęp do clienta) który
                            //wywoła drógi handler w /handlers który zwróci dane o serwerze(kanały itd)

                            // Zmodyfikowany kod JavaScript
                            const serverDetailsContainer = document.querySelector('.server-details');
                            if (serverDetailsContainer) {
                                const serverAvatarContainer = document.getElementById('server-avatar-container');
                                const serverNameElement = document.getElementById('server-name');

                                if (serverAvatarContainer && serverNameElement) {
                                    // Set the server avatar image
                                    const serverAvatar = document.createElement('img');
                                    serverAvatar.src = `https://cdn.discordapp.com/icons/${server.id}/${server.icon}.png`;
                                    serverAvatarContainer.appendChild(serverAvatar);

                                    // Set the server name
                                    serverNameElement.innerText = server.name;
                                } else {
                                    console.error("Elements 'server-avatar-container' or 'server-name' not found.");
                                }
                            } else {
                                console.error("Element 'server-details' not found.");
                            }

                        })
                        .catch(console.error);
                })
                .catch(console.error);


            //load channels options for welcome command
            function populateChannels() {
                // Pobierz listę kanałów z serwera (możesz to zaimplementować według potrzeb)
                const channelList = ['Channel 1', 'Channel 2', 'Channel 3'];

                // Znajdź pole do wyboru kanału w dokumencie
                const channelSelect = document.getElementById('channelSelect');

                // Wyczyść istniejące opcje
                channelSelect.innerHTML = '';

                // Dodaj nowe opcje do pola wyboru
                channelList.forEach(channel => {
                    const option = document.createElement('option');
                    option.value = channel;
                    option.text = channel;
                    channelSelect.appendChild(option);
                });
            }
            populateChannels();

            function setSwitchButtonState() {
                const switchButton = document.getElementById('switchButton');

                // Ustaw pozycję początkową na włączoną lub wyłączoną, w zależności od potrzeb
                const initialState = true; // zmień na false, jeśli chcesz, aby switchButton był początkowo wyłączony
                switchButton.checked = initialState;
            }

            // Wywołanie funkcji po wczytaniu strony
            setSwitchButtonState();
        };

        function toggleWelcomeCommand(i) {
            console.log("Change welcome channel status")
        }
    </script>

</body>

</html>